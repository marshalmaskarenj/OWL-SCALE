"""
This component generates Circadian metrics of CS and CLa following the LRC circadian light combined calculator (REFER TO https://www.lrc.rpi.edu/programs/lightHealth/index.asp )
Works in conjunction with SCALE_RelativeCombinedSPD component 
--
OWL (Occupant Well-being through Lighting) is developed by Marshal Maskarenj, for SCALE project funded by FNRS @ LOCI, UCLouvain.
    Inputs:
        Rel_comb_SPD: Relative combined SPD between 380-730nm (176 values for 2nm bins). Connects to output of RelativeCombinedSPD component.
        net_illum: Net illuminance on the horizontal plane or at the eye due to all patches. Connects to output of RelativeCombinedSPD component.
    Output:
        CLa: Circadian Lighting metric of LRC.
        CStim: Circadian Stimulus metric of LRC."""

self=ghenv.Component
self.Name = "SCALE_circadLight"
self.NickName = 'circadLight'
self.Message = 'OWL 0.0.01\nOCT_15_2021'
self.IconDisplayMode = self.IconDisplayMode.application
self.Category = "SCALE"
self.SubCategory = "3 OWL::Spectral"
try: self.AdditionalHelpFromDocStrings = "2"
except: pass
import rhinoscriptsyntax as rs
import math

def sum_prod(a,b,c):
    new_arr=[ii*jj*kk for ii,jj,kk in zip(a,b,c)]
    return sum(new_arr)

#GHIJKL
phot_arr=[0.000039,0.000046915,0.000057176,0.000072344,0.000093508,0.00012,0.00015149,0.00019182,0.00024691,0.00031852,0.000396,0.00047302,0.00057222,0.00072456,0.00094116,0.00121,0.0015308,0.0019353,0.0024548,0.0031178,0.004,0.0051593,0.0065462,0.0080865,0.0097677,0.0116,0.013583,0.015715,0.018007,0.020454,0.023,0.02561,0.028351,0.031311,0.034521,0.038,0.041768,0.045843,0.050244,0.054981,0.06,0.065278,0.070911,0.077016,0.083667,0.09098,0.099046,0.10788,0.11753,0.12799,0.13902,0.15047,0.16272,0.17624,0.19127,0.20802,0.22673,0.24748,0.27018,0.29505,0.323,0.35469,0.38929,0.42563,0.46339,0.503,0.54451,0.58697,0.62935,0.67088,0.71,0.74546,0.77784,0.80811,0.83631,0.862,0.88496,0.90544,0.92373,0.93992,0.954,0.96601,0.97602,0.98409,0.99031,0.99495,0.9981,0.99975,0.99986,0.99833,0.995,0.98974,0.98272,0.97408,0.96386,0.952,0.9385,0.92346,0.90701,0.8892,0.87,0.84939,0.82758,0.80479,0.78119,0.757,0.73242,0.7075,0.68222,0.65667,0.631,0.60531,0.57964,0.55396,0.52835,0.503,0.47803,0.4534,0.42908,0.40503,0.381,0.35683,0.33282,0.30934,0.28659,0.265,0.24489,0.22605,0.20816,0.19116,0.175,0.15965,0.14513,0.1315,0.11878,0.107,0.096189,0.086265,0.077121,0.06871,0.061,0.053955,0.04755,0.041759,0.036564,0.032,0.028077,0.024708,0.021801,0.019281,0.017,0.014837,0.012835,0.011068,0.0095333,0.00821,0.0070854,0.0061385,0.0053431,0.0046764,0.004102,0.0035891,0.0031341,0.0027381,0.0023932,0.002091,0.0018246,0.0015902,0.0013845,0.0012041,0.001047,0.00091111,0.00079324,0.00069008,0.0005995,0.00052]
scot_arr=[0.000589,0.000752,0.000972,0.001268,0.001668,0.002209,0.002939,0.003921,0.00524,0.00698,0.00929,0.01231,0.01619,0.02113,0.0273,0.03484,0.0439,0.0545,0.0668,0.0808,0.0966,0.1141,0.1334,0.1541,0.1764,0.1998,0.2243,0.2496,0.2755,0.3017,0.3281,0.3543,0.3803,0.406,0.431,0.455,0.479,0.502,0.524,0.546,0.567,0.588,0.61,0.631,0.653,0.676,0.699,0.722,0.745,0.769,0.793,0.817,0.84,0.862,0.884,0.904,0.923,0.941,0.957,0.97,0.982,0.99,0.997,1,1,0.997,0.99,0.981,0.968,0.953,0.935,0.915,0.892,0.867,0.84,0.811,0.781,0.749,0.717,0.683,0.65,0.616,0.581,0.548,0.514,0.481,0.448,0.417,0.3864,0.3569,0.3288,0.3018,0.2762,0.2519,0.2291,0.2076,0.1876,0.169,0.1517,0.1358,0.1212,0.1078,0.0956,0.0845,0.0745,0.0655,0.0574,0.0502,0.0438,0.0382,0.03315,0.02874,0.02487,0.02147,0.01851,0.01593,0.01369,0.01175,0.01007,0.00862,0.00737,0.0063,0.00538,0.00459,0.003913,0.003335,0.002842,0.002421,0.002062,0.001757,0.001497,0.001276,0.001088,0.000928,0.000792,0.000677,0.000579,0.000496,0.000425,0.0003645,0.0003129,0.0002689,0.0002313,0.0001991,0.0001716,0.000148,0.0001277,0.0001104,0.0000954,0.0000826,0.0000715,0.000062,0.0000538,0.0000467,0.0000406,0.00003533,0.00003075,0.00002679,0.00002336,0.00002038,0.0000178,0.00001556,0.0000136,0.00001191,0.00001043,0.00000914,0.00000802,0.00000704,0.00000618,0.00000544,0.00000478,0.00000421,0.000003709,0.00000327,0.000002884,0.000002546]
vlamb_arr=[0,0,0,0,0,0.0001,0.0001,0.0002,0.0002,0.0003,0.0007,0.0008,0.001,0.0013,0.0017,0.0022,0.0028,0.0036,0.0047,0.0061,0.0081,0.0108,0.0142,0.0181,0.0225,0.0275,0.0327,0.0384,0.0447,0.0516,0.0589,0.067,0.0758,0.0856,0.0966,0.109,0.1224,0.1374,0.153,0.1689,0.1861,0.1992,0.2131,0.2274,0.2423,0.2585,0.2752,0.2932,0.3158,0.3436,0.3729,0.4032,0.4357,0.4697,0.5055,0.5453,0.5817,0.6217,0.6547,0.6805,0.7107,0.7305,0.7536,0.7735,0.7899,0.8074,0.8259,0.8439,0.8569,0.8646,0.8685,0.8882,0.9033,0.9146,0.9223,0.9269,0.9415,0.9531,0.9621,0.9686,0.9729,0.9815,0.988,0.9925,0.9951,0.9961,0.9988,1,0.9996,0.9977,0.9939,0.9873,0.9789,0.969,0.9575,0.9444,0.9306,0.9152,0.8985,0.8805,0.8611,0.8391,0.8161,0.7921,0.7675,0.7423,0.7182,0.6938,0.669,0.644,0.6188,0.5936,0.5684,0.5432,0.5181,0.4933,0.4688,0.4446,0.4208,0.3972,0.3736,0.3499,0.3264,0.3033,0.281,0.2599,0.2401,0.2217,0.2041,0.1875,0.1716,0.1566,0.1423,0.129,0.1165,0.1049,0.0943,0.0846,0.0756,0.0674,0.0598,0.0529,0.0466,0.041,0.0359,0.0314,0.0275,0.0242,0.0214,0.0189,0.0167,0.0145,0.0126,0.0109,0.0093,0.0081,0.0069,0.006,0.0052,0.0046,0.004,0.0035,0.0031,0.0027,0.0023,0.0021,0.0018,0.0016,0.0014,0.0012,0.001,0.0009,0.0008,0.0007,0.0006,0.0005]
s_con_arr=[0,0,0,0,0,0.0029,0.0153,0.0277,0.0401,0.0526,0.1088,0.1349,0.1619,0.1898,0.2188,0.2488,0.2947,0.3423,0.3935,0.4494,0.5086,0.5655,0.6265,0.6884,0.7502,0.8155,0.8458,0.8769,0.9088,0.9415,0.9751,0.979,0.983,0.9879,0.9938,1,0.9965,0.9928,0.9822,0.9646,0.9466,0.9064,0.8675,0.828,0.788,0.7496,0.6858,0.6248,0.5721,0.526,0.48,0.4402,0.4006,0.3596,0.3179,0.2768,0.2489,0.2222,0.1935,0.1644,0.138,0.1183,0.101,0.0853,0.071,0.0584,0.0496,0.0418,0.0346,0.028,0.0221,0.0195,0.0171,0.0148,0.0126,0.0105,0.0093,0.0082,0.007,0.0059,0.0048,0.0043,0.0037,0.0032,0.0026,0.0021,0.0018,0.0016,0.0014,0.0011,0.0009,0.0008,0.0008,0.0007,0.0006,0.0006,0.0005,0.0005,0.0004,0.0004,0.0003,0.0003,0.0003,0.0003,0.0003,0.0003,0.0003,0.0003,0.0003,0.0003,0.0003,0.0002,0.0002,0.0001,0.0001,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
melan_arr=[0.001209182,0.001877011,0.002710613,0.003744419,0.004880802,0.006092171,0.009099363,0.012593135,0.016610707,0.021070143,0.025947437,0.035432854,0.045898853,0.057306923,0.070101599,0.084430355,0.10466962,0.126202805,0.14884959,0.174027865,0.202094062,0.233614243,0.266351746,0.299850387,0.335161112,0.372410565,0.403951246,0.435995405,0.468412667,0.502011561,0.538048422,0.564285985,0.590757596,0.618670738,0.647273594,0.676018566,0.701307844,0.727285228,0.753961936,0.781559637,0.809646145,0.833608606,0.857290338,0.880046047,0.901175408,0.921389176,0.94062421,0.957205809,0.972050647,0.984091925,0.993764598,0.998953263,1,0.999095768,0.995156098,0.989182216,0.980550569,0.968645846,0.954254284,0.937147496,0.917380944,0.895084971,0.870684754,0.844036187,0.81571098,0.78560144,0.752761413,0.718842908,0.684398864,0.650113565,0.614446927,0.579561508,0.545242788,0.510797154,0.476831487,0.443922147,0.412364095,0.381457277,0.351897566,0.323598971,0.29655967,0.270943279,0.24677175,0.224033062,0.202716275,0.18289771,0.164471715,0.1474327,0.131790674,0.117445604,0.104347008,0.092428407,0.081630251,0.071907434,0.063172589,0.055374099,0.048438614,0.042292669,0.03684654,0.032025686,0.027789446,0.024052214,0.020778272,0.017922992,0.015434337,0.013273325,0.011389349,0.009759584,0.008352779,0.007147198,0.006115108,0.005224447,0.004459542,0.003804661,0.003245427,0.002767672,0.002359566,0.002011961,0.001715896,0.001464252,0.001250589,0.001067481,0.000911543,0.000779284,0.00066692,0.000571372,0.000490005,0.000420427,0.000361073,0.000310556,0.000267505,0.000230391,0.000198625,0.000171417,0.000147999,0.000127947,0.000110692,9.58315E-05,8.30425E-05,7.2007E-05,6.25247E-05,5.42618E-05,4.71353E-05,4.10011E-05,3.56826E-05,3.10708E-05,2.70818E-05,2.36204E-05,2.06182E-05,1.80172E-05,1.57479E-05,1.37773E-05,1.20663E-05,1.05695E-05,9.26842E-06,8.13493E-06,7.14006E-06,6.27702E-06,5.52075E-06,4.85594E-06,4.27795E-06,3.7702E-06,3.32452E-06,2.93314E-06,0,0,0,0,0,0,0,0,0,0,0,0]
del_wav_arr=[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1]
rc_SPD_arr=Rel_comb_SPD
illum_net=float(net_illum)
M_arr=[ix*illum_net/(683*sum_prod(phot_arr,del_wav_arr,rc_SPD_arr)) for ix in rc_SPD_arr]
Circ_la=1547.9*(sum_prod(M_arr,del_wav_arr,melan_arr)+0.7*(sum_prod(M_arr,del_wav_arr,s_con_arr)-0.2616*sum_prod(M_arr,del_wav_arr,vlamb_arr))-3.3*(1-math.exp(-1*sum_prod(M_arr,del_wav_arr,scot_arr)/6.5215)))
Circ_stim=0.7*(1-(1/(1+(Circ_la/355.7)**1.1026)))
CLa=round(Circ_la, 2)
CStim=Circ_stim